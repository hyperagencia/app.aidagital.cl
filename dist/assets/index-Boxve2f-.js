import{c as e,l as t,a as s,j as a,U as r,f as i}from"./index-OzZPaPgP.js";import{a as c}from"./vendor-BAsl6vX1.js";import{a as n,c as l}from"./creatorsService-1IPkqGh_.js";const o=new class{constructor(){this.baseEndpoint=e.ENDPOINTS.STATS.DASHBOARD}async getDashboardStats(){try{t("Fetching dashboard statistics");const s=await n.get(this.baseEndpoint);if(s.success)return t("Dashboard stats fetched successfully"),{success:!0,stats:s.data.stats};throw new Error(s.message||e.ERRORS.UNKNOWN)}catch(a){throw s(a,"Get dashboard stats"),new Error(a.message||e.ERRORS.NETWORK)}}async getCreatorsStats(){try{t("Fetching creators statistics");const s=await n.get(e.ENDPOINTS.STATS.CREATORS);if(s.success)return t("Creators stats fetched successfully"),{success:!0,stats:s.data.stats};throw new Error(s.message||e.ERRORS.UNKNOWN)}catch(a){throw s(a,"Get creators stats"),new Error(a.message||e.ERRORS.NETWORK)}}async getRecentActivity(a=10){try{t("Fetching recent activity");const s=await n.get("/activity/recent",{limit:a});if(s.success)return t("Recent activity fetched successfully"),{success:!0,activities:s.data.activities};throw new Error(s.message||e.ERRORS.UNKNOWN)}catch(r){throw s(r,"Get recent activity"),new Error(r.message||e.ERRORS.NETWORK)}}calculateStatsFromCreators(e){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=e.length,i=e.filter(e=>new Date(e.created_at)>=s).length,c=e.filter(e=>new Date(e.created_at)>=a).length,n={};e.forEach(e=>{e.platforms&&e.platforms.forEach(e=>{n[e]=(n[e]||0)+1})});const l={};e.forEach(e=>{e.nationality&&(l[e.nationality]=(l[e.nationality]||0)+1)});const o={};e.forEach(e=>{e.location&&(o[e.location]=(o[e.location]||0)+1)});const d={"18-24":0,"25-34":0,"35-44":0,"45+":0};e.forEach(e=>{const t=parseInt(e.age);isNaN(t)||(t>=18&&t<=24?d["18-24"]++:t>=25&&t<=34?d["25-34"]++:t>=35&&t<=44?d["35-44"]++:t>=45&&d["45+"]++)});const m={};e.forEach(e=>{e.interests&&e.interests.forEach(e=>{m[e]=(m[e]||0)+1})});const h=Object.entries(m).sort(([,e],[,t])=>t-e).slice(0,5).reduce((e,[t,s])=>(e[t]=s,e),{}),g=Math.max(0,r-i),x=g>0?i/g*100-100:0;return{overview:{total:r,thisMonth:i,today:c,monthlyGrowth:Math.round(10*x)/10},platforms:n,nationalities:l,locations:o,ageRanges:d,topInterests:h,lastUpdated:(new Date).toISOString()}}generateChartData(e){const t=[],s=new Date;for(let a=6;a>=0;a--){const r=new Date(s);r.setDate(r.getDate()-a);const i=e.filter(e=>new Date(e.created_at).toDateString()===r.toDateString());t.push({date:r.toLocaleDateString("es-CL",{weekday:"short",day:"numeric"}),creators:i.length,fullDate:r.toISOString().split("T")[0]})}return{weeklyRegistrations:t}}async getPerformanceMetrics(){try{const t=await n.get("/metrics/performance");if(t.success)return{success:!0,metrics:t.data.metrics};throw new Error(t.message||e.ERRORS.UNKNOWN)}catch(t){return s(t,"Get performance metrics"),{success:!0,metrics:{averageResponseTime:"1.2s",uptime:"99.9%",totalRequests:15847,errorRate:"0.1%"}}}}async getNotifications(){try{const t=await n.get("/notifications");if(t.success)return{success:!0,notifications:t.data.notifications};throw new Error(t.message||e.ERRORS.UNKNOWN)}catch(t){return s(t,"Get notifications"),{success:!0,notifications:[]}}}async markNotificationAsRead(t){try{const s=await n.put(`/notifications/${t}/read`);if(s.success)return{success:!0};throw new Error(s.message||e.ERRORS.UNKNOWN)}catch(a){return s(a,"Mark notification as read"),{success:!1,message:a.message}}}},d=(e=10)=>{const[s,a]=c.useState([]),[r,i]=c.useState(!0),[n,l]=c.useState(null),d=c.useCallback(async()=>{try{i(!0),l(null);const s=await o.getRecentActivity(e);s.success&&(a(s.activities),t(`Loaded ${s.activities.length} recent activities`))}catch(s){l(s.message);const r=function(e){const t=[{id:1,type:"creator_registered",message:"Nuevo creator registrado: María González",timestamp:new Date(Date.now()-18e5).toISOString(),icon:"👤",user:"María González"},{id:2,type:"export_completed",message:"Exportación de creators completada",timestamp:new Date(Date.now()-72e5).toISOString(),icon:"📊",user:"Admin"},{id:3,type:"creator_registered",message:"Nuevo creator registrado: Carlos Pérez",timestamp:new Date(Date.now()-144e5).toISOString(),icon:"👤",user:"Carlos Pérez"},{id:4,type:"brand_assigned",message:"Marca asignada a creator: Ana Martín",timestamp:new Date(Date.now()-216e5).toISOString(),icon:"🏪",user:"Admin"},{id:5,type:"creator_registered",message:"Nuevo creator registrado: Luis Rodríguez",timestamp:new Date(Date.now()-288e5).toISOString(),icon:"👤",user:"Luis Rodríguez"}];return t.slice(0,e)}(e);a(r),t("Using mock activities due to error:",s.message)}finally{i(!1)}},[e]);c.useEffect(()=>{d()},[d]);return{activities:s,loading:r,error:n,refresh:c.useCallback(()=>{d()},[d])}};const m=({title:e,value:t,change:s,changeType:c="neutral",icon:n,bgColor:l="bg-white",textColor:o="text-gray-900",onClick:d,loading:m=!1})=>{const h={positive:"text-green-600",negative:"text-red-600",neutral:"text-gray-500"},g=h[c]||h.neutral;return a.jsx(r.Card,{className:`${l} ${d?"cursor-pointer":""} hover:shadow-lg transition-all duration-300`,onClick:d,padding:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`text-sm font-medium ${o} opacity-75 mb-1`,children:e}),a.jsxs("div",{className:"flex items-baseline space-x-2",children:[m?a.jsx(r.Skeleton,{width:"w-16",height:"h-8"}):a.jsx("p",{className:`text-3xl font-bold ${o}`,children:"number"==typeof t?i.formatNumber(t):t}),s&&!m&&a.jsxs("span",{className:`text-sm font-medium ${g}`,children:[s>0?"+":"",s,"%"]})]})]}),n&&a.jsx("div",{className:`text-2xl ${o} opacity-75`,children:n})]})})},h=({platforms:e,loading:t=!1})=>{if(t)return a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribución por Plataformas"}),a.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(r.Skeleton,{width:"w-20",height:"h-4"}),a.jsx(r.Skeleton,{width:"w-8",height:"h-4"})]},t))})]});const s=Object.entries(e||{}),c=s.reduce((e,[,t])=>e+t,0);return a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribución por Plataformas"}),a.jsxs("div",{className:"space-y-4",children:[s.map(([e,t])=>{const s=c>0?t/c*100:0;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.formatPlatform(e)}),a.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 min-w-20",children:a.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]}),a.jsx("span",{className:"text-lg font-bold text-purple-600",children:t})]},e)}),0===s.length&&a.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay datos de plataformas disponibles"})]})]})},g=({limit:e=5})=>{const{activities:t,loading:s,error:c}=d(e);return s?a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actividad Reciente"}),a.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(r.Skeleton,{width:"w-8",height:"h-8",className:"rounded-full"}),a.jsxs("div",{className:"flex-1",children:[a.jsx(r.Skeleton,{width:"w-full",height:"h-4",className:"mb-2"}),a.jsx(r.Skeleton,{width:"w-20",height:"h-3"})]})]},t))})]}):c?a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actividad Reciente"}),a.jsx(r.Alert,{type:"error",children:"Error al cargar actividad reciente"})]}):a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-4",children:[t.map(e=>a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:a.jsx("span",{className:"text-sm",children:e.icon})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.message}),a.jsx("p",{className:"text-xs text-gray-500",children:i.formatTimeAgo(e.timestamp)})]})]},e.id)),0===t.length&&a.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay actividad reciente"})]})]})},x=({onNavigate:e})=>{const t=[{id:"view-creators",title:"Ver Creators",description:"Gestionar base de creators",icon:"👥",color:"bg-blue-500",action:()=>null==e?void 0:e("creators")},{id:"export-data",title:"Exportar Datos",description:"Descargar información",icon:"📊",color:"bg-green-500",action:()=>{}},{id:"manage-brands",title:"Gestionar Marcas",description:"Administrar marcas cliente",icon:"🏪",color:"bg-purple-500",action:()=>null==e?void 0:e("brands")},{id:"view-analytics",title:"Ver Analytics",description:"Estadísticas detalladas",icon:"📈",color:"bg-orange-500",action:()=>{}}];return a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Acciones Rápidas"}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:t.map(e=>a.jsx("button",{onClick:e.action,className:"p-4 text-left rounded-lg border border-gray-200 hover:border-purple-300 hover:shadow-md transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center text-white group-hover:scale-110 transition-transform duration-200`,children:a.jsx("span",{className:"text-lg",children:e.icon})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),a.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]})},e.id))})]})},u=({onNavigate:s})=>{var n,d,u,f,p;const{stats:v,loading:y,error:N,refresh:j}=((e=!0)=>{const[s,a]=c.useState(null),[r,i]=c.useState(!0),[n,d]=c.useState(null),[m,h]=c.useState(null),g=c.useCallback(async()=>{try{if(i(!0),d(null),e){const e=await l.getCreators();if(e.success){const s=o.calculateStatsFromCreators(e.creators);a(s),h(new Date),t("Stats calculated locally from creators data")}}else{const e=await o.getDashboardStats();e.success&&(a(e.stats),h(new Date),t("Stats fetched from server"))}}catch(s){d(s.message),t("Error fetching dashboard stats:",s.message)}finally{i(!1)}},[e]);return c.useEffect(()=>{g()},[g]),{stats:s,loading:r,error:n,lastUpdated:m,refresh:c.useCallback(()=>{g()},[g])}})();return N?a.jsx("div",{className:"flex-1 bg-gray-50 overflow-auto p-8",children:a.jsxs(r.Card,{className:"p-8 text-center",children:[a.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error al cargar el dashboard"}),a.jsx("p",{className:"text-gray-600 mb-4",children:N}),a.jsx(r.Button,{variant:"primary",onClick:j,children:"Reintentar"})]})}):a.jsx("div",{className:"flex-1 bg-gray-50 overflow-auto",children:a.jsxs("div",{className:"p-8 max-w-7xl",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-3",children:"Dashboard UGC Creators"}),a.jsx("p",{className:"text-lg text-gray-600",children:"Resumen de actividad y estadísticas principales"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx(m,{title:"Total Creators",value:(null==(n=null==v?void 0:v.overview)?void 0:n.total)||0,icon:"👥",bgColor:"bg-white",textColor:"text-gray-700",loading:y,onClick:()=>null==s?void 0:s("creators")}),a.jsx(m,{title:"Registros este mes",value:(null==(d=null==v?void 0:v.overview)?void 0:d.thisMonth)||0,change:null==(u=null==v?void 0:v.overview)?void 0:u.monthlyGrowth,changeType:(null==(f=null==v?void 0:v.overview)?void 0:f.monthlyGrowth)>0?"positive":"negative",icon:"📈",bgColor:"bg-gradient-to-br from-purple-500 to-purple-600",textColor:"text-white",loading:y}),a.jsx(m,{title:"Registros hoy",value:(null==(p=null==v?void 0:v.overview)?void 0:p.today)||0,icon:"⭐",bgColor:"bg-white",textColor:"text-gray-700",loading:y})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsx(h,{platforms:null==v?void 0:v.platforms,loading:y}),a.jsx(g,{limit:5}),a.jsx(x,{onNavigate:s}),a.jsxs(r.Card,{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información del Sistema"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Versión"}),a.jsxs(r.Badge,{variant:"gray",size:"sm",children:["v",e.APP_VERSION]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Última actualización"}),a.jsx("span",{className:"text-sm text-gray-900",children:(null==v?void 0:v.lastUpdated)?i.formatTimeAgo(v.lastUpdated):"Hace un momento"})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Estado"}),a.jsx(r.Badge,{variant:"green",size:"sm",children:"Operativo"})]})]})]})]})]})})},f={DashboardPage:u,StatsCard:m,PlatformStats:h,RecentActivity:g,QuickActions:x};export{u as DashboardPage,h as PlatformStats,x as QuickActions,g as RecentActivity,m as StatsCard,f as dashboardComponents,f as default};
